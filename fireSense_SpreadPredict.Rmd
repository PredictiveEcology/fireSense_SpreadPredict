---
title: "fireSense_SpreadPredict"
author: "Jean Marchal (jean.d.marchal@gmail.com)"
date: "August 2017"
output:
  html_document: default
  pdf_document: default
---

# Overview
Predicts a surface of fire spread probilities using a model fitted with fireSense_SpreadFit.

# Download the module
```{r download module, eval = FALSE, echo = TRUE}
library(SpaDES)

moduleName <- "fireSense_SpreadPredict"

spadesModulesDirectory <- tempdir() # Location where the module will be downloaded

downloadModule(moduleName, path = spadesModulesDirectory)
```

# Usage
## Module parameters
Name|Default|Description
----|:-------|---------------------------------------------------------------------
`model`|`"fireSense_SpreadFitted"`|a character vector indicating the name of a model object created with the fireSense_SpreadFit module.
`data`|`"dataFireSense_SpreadPredict"`|a character vector indicating the names of objects in the `simList` environment in which to look for variables present in the model formula. `data` objects can be RasterLayers or RasterStacks. For time series, `data` objects must be named lists of data.frames, RasterStacks or RasterLayers, named starting with `start(simList)` and ending with `end(simList)` such that variables can be matched for every `timeunit(simList)` of the simulation.
`mapping`|`NULL`|optional named vector or list of character strings mapping one or more variables in the model formula to those in data objects.
`initialRunTime`|`start(simList)`|when to start this module? By default, the start time of the simulation.
`intervalRunModule`|`NA`|optional. Interval between two runs of this module, expressed in units of simulation time.
|||

## Usage example
```{r module usage example, eval = FALSE}
library(magrittr)
library(raster)
library(SpaDES)

set.seed(123)

# Define simulation parameters
times <- list(start = 1, end = 1, timeunit = "year")
modules <- list("fireSense_SpreadPredict")
paths <- list(
  modulePath = spadesModulesDirectory
)

# Create a random map of weather
nx <- ny <- 100L
weather <- raster(nrows = ny, ncols = nx, xmn = -nx/2, xmx = nx/2, ymn = -ny/2, ymx = ny/2) %>%
  gaussMap(scale = 300, var = 1, speedup = 1, inMemory = TRUE)

# Create a typical output of fireSense_SpreadFit
fireSense_SpreadFitted <- list(
  formula = ~ weather2 -1,
  coef = setNames(c(0.3, 3, 0.1, 1.5, 3),
                  c("A", "B", "D", "G", "weather")) # A, B, D, G are parameters of the 5-parameters logistic function
)
class(fireSense_SpreadFitted) <- "fireSense_SpreadFit"

parameters <- list(
  fireSense_SpreadPredict = list(
    mapping = list(weather2 = "weather") # One can use mapping to map variables
                                         # in the formula of the fitted object
                                         # to those in data. Here weather2
                                         # (formula) is mapped to weather (data).
  )
)

# Objects to pass from the global environment to the simList environment
objects <- c("weather", "fireSense_SpreadFitted")

# Create the simList
sim <- simInit(
  times = times,
  modules = modules,
  paths = paths,
  params = parameters,
  objects = objects
)

sim <- spades(sim)

x11(); Plot(weather, sim$fireSense_SpreadPredicted)
```

# Events
Events are scheduled as follows:

- Module initiation
- Make predictions

## Saving
TODO: Write what is saved. (there is currently nothing saved, but this may change in the future)

# Data dependencies
## Input data
- **fireSense_SpreadFitted**: an object of class `fireSense_SpreadFit` created with the fireSense_SpreadFit module.
- **dataFireSense_SpreadPredict**: one or more RasterLayers or RasterStacks in which to look for variables present in the model formula.

## Output data
- **fireSense_SpreadPredicted**: an object whose class depends on those in input:

Input object class | Output object class
:-:|:-:
`RasterLayer` | `RasterLayer`
`RasterStack` | `RasterStack`
||

# Links to other modules
Predictions made with this module can be used to feed the fire spread component of landscape fire models (e.g. fireSense).

